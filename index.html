<!DOCTYPE html>
<html lang="pl">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>SzonPatrol - Zaloguj się</title>
    <link rel="stylesheet" href="style.css">
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Fredoka+One&family=Nunito:wght@400;700&display=swap" rel="stylesheet">
</head>
<body class="login-page">

    <!-- Ten kontener będzie się zmieniał w zależności od tego, czy się logujemy, czy rejestrujemy -->
    <div class="login-container" id="auth-container">
        <div class="logo">
            <img src="alarm_1843912.png" alt="SzonPatrol Logo">
            <h1>SzonPatrol</h1>
        </div>
        
        <!-- Widok logowania (domyślny) -->
        <div id="login-view">
            <h2>Zaloguj się, by kontynuować</h2>
            <a href="#" id="google-login-btn" class="google-btn">
                <img src="https://upload.wikimedia.org/wikipedia/commons/c/c1/Google_%22G%22_logo.svg" alt="Google logo">
                Kontynuuj z Google
            </a>
            <div class="separator">LUB</div>
            <form id="login-form">
                <div class="input-group">
                    <label for="login-email">Email</label>
                    <input type="email" id="login-email" placeholder="you@example.com" required>
                </div>
                <div class="input-group">
                    <label for="login-password">Hasło</label>
                    <input type="password" id="login-password" required>
                </div>
                <button type="submit" class="btn-primary">Zaloguj się</button>
            </form>
            <div class="login-footer">
                <a href="#">Zapomniałeś hasła?</a>
                <a href="#" id="show-register">Potrzebujesz konta? Zarejestruj się</a>
            </div>
        </div>

        <!-- Widok rejestracji (ukryty) -->
        <div id="register-view" style="display: none;">
            <h2>Stwórz nowe konto</h2>
            <form id="register-form">
                 <div class="input-group">
                    <label for="register-name">Twoja nazwa (wyświetlana)</label>
                    <input type="text" id="register-name" required>
                </div>
                <div class="input-group">
                    <label for="register-email">Email</label>
                    <input type="email" id="register-email" placeholder="you@example.com" required>
                </div>
                <div class="input-group">
                    <label for="register-password">Hasło (min. 6 znaków)</label>
                    <input type="password" id="register-password" required>
                </div>
                <button type="submit" class="btn-primary">Zarejestruj się</button>
            </form>
            <div class="login-footer">
                <a href="#" id="show-login">Masz już konto? Zaloguj się</a>
            </div>
        </div>
    </div>

    <!-- SCRIPTY FIREBASE -->
    <script type="module">
      import { initializeApp } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-app.js";
      // ZAKTUALIZOWANE IMPORTY
      import { getAuth, GoogleAuthProvider, signInWithPopup, createUserWithEmailAndPassword, signInWithEmailAndPassword, updateProfile } from "https://www.gstatic.com/firebasejs/10.7.1/firebase-auth.js";

      const firebaseConfig = {
        apiKey: "AIzaSyCuibYJxksPJqZZ3C0EgjnhccnSku6EQW8",
        authDomain: "szonpatrol-a33a2.firebaseapp.com",
        projectId: "szonpatrol-a33a2",
        storageBucket: "szonpatrol-a33a2.appspot.com",
        messagingSenderId: "508795650559",
        appId: "1:508795650559:web:3e3eef5060a7d64d5967ca",
        measurementId: "G-XBR987MZGH"
      };

      const app = initializeApp(firebaseConfig);
      const auth = getAuth(app);

      // --- PRZEŁĄCZANIE WIDOKÓW ---
      const loginView = document.getElementById('login-view');
      const registerView = document.getElementById('register-view');
      document.getElementById('show-register').addEventListener('click', () => {
        loginView.style.display = 'none';
        registerView.style.display = 'block';
      });
      document.getElementById('show-login').addEventListener('click', () => {
        registerView.style.display = 'none';
        loginView.style.display = 'block';
      });

      // --- LOGIKA REJESTRACJI ---
      const registerForm = document.getElementById('register-form');
      registerForm.addEventListener('submit', async (e) => {
        e.preventDefault(); // Zapobiegaj przeładowaniu strony
        const displayName = document.getElementById('register-name').value;
        const email = document.getElementById('register-email').value;
        const password = document.getElementById('register-password').value;

        try {
          const userCredential = await createUserWithEmailAndPassword(auth, email, password);
          // Ustawiamy nazwę wyświetlaną dla nowego użytkownika
          await updateProfile(userCredential.user, { displayName: displayName });
          
          console.log('Zarejestrowano i zalogowano!', userCredential.user);
          window.location.href = 'mapa.html'; // Przekieruj po sukcesie
        } catch (error) {
          console.error('Błąd rejestracji:', error.code);
          alert(`Błąd rejestracji: ${error.message}`);
        }
      });

      // --- LOGIKA LOGOWANIA PRZEZ EMAIL/HASŁO ---
      const loginForm = document.getElementById('login-form');
      loginForm.addEventListener('submit', (e) => {
        e.preventDefault();
        const email = document.getElementById('login-email').value;
        const password = document.getElementById('login-password').value;

        signInWithEmailAndPassword(auth, email, password)
          .then((userCredential) => {
            console.log('Zalogowano pomyślnie!', userCredential.user);
            window.location.href = 'mapa.html';
          })
          .catch((error) => {
            console.error('Błąd logowania:', error.code);
            alert(`Błąd logowania: ${error.message}`);
          });
      });

      // --- Logika logowania Google (bez zmian) ---
      document.getElementById('google-login-btn').addEventListener('click', () => {
        const provider = new GoogleAuthProvider();
        signInWithPopup(auth, provider)
          .then(() => { window.location.href = 'mapa.html'; })
          .catch((error) => { alert(`Błąd: ${error.message}`); });
      });
    </script>
</body>
</html>